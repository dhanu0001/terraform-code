{"version":3,"file":"schema-1982362e.esm.js","sources":["../../src/extensions/default.ts","../../src/next/TemplateWizardPage/Stepper/schema.ts"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  EntityPicker,\n  EntityPickerSchema,\n} from '../components/fields/EntityPicker/EntityPicker';\nimport {\n  EntityNamePicker,\n  EntityNamePickerSchema,\n} from '../components/fields/EntityNamePicker/EntityNamePicker';\nimport { entityNamePickerValidation } from '../components/fields/EntityNamePicker/validation';\nimport {\n  EntityTagsPicker,\n  EntityTagsPickerSchema,\n} from '../components/fields/EntityTagsPicker/EntityTagsPicker';\nimport {\n  OwnerPicker,\n  OwnerPickerSchema,\n} from '../components/fields/OwnerPicker/OwnerPicker';\nimport {\n  RepoUrlPicker,\n  RepoUrlPickerSchema,\n} from '../components/fields/RepoUrlPicker/RepoUrlPicker';\nimport { repoPickerValidation } from '../components/fields/RepoUrlPicker/validation';\nimport {\n  OwnedEntityPicker,\n  OwnedEntityPickerSchema,\n} from '../components/fields/OwnedEntityPicker/OwnedEntityPicker';\n\nexport const DEFAULT_SCAFFOLDER_FIELD_EXTENSIONS = [\n  {\n    component: EntityPicker,\n    name: 'EntityPicker',\n    schema: EntityPickerSchema,\n  },\n  {\n    component: EntityNamePicker,\n    name: 'EntityNamePicker',\n    validation: entityNamePickerValidation,\n    schema: EntityNamePickerSchema,\n  },\n  {\n    component: EntityTagsPicker,\n    name: 'EntityTagsPicker',\n    schema: EntityTagsPickerSchema,\n  },\n  {\n    component: RepoUrlPicker,\n    name: 'RepoUrlPicker',\n    validation: repoPickerValidation,\n    schema: RepoUrlPickerSchema,\n  },\n  {\n    component: OwnerPicker,\n    name: 'OwnerPicker',\n    schema: OwnerPickerSchema,\n  },\n  {\n    component: OwnedEntityPicker,\n    name: 'OwnedEntityPicker',\n    schema: OwnedEntityPickerSchema,\n  },\n];\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { JsonObject } from '@backstage/types';\nimport { FieldValidation, UiSchema } from '@rjsf/utils';\n\nfunction isObject(value: unknown): value is JsonObject {\n  return typeof value === 'object' && value !== null && !Array.isArray(value);\n}\n\nfunction extractUiSchema(schema: JsonObject, uiSchema: JsonObject) {\n  if (!isObject(schema)) {\n    return;\n  }\n\n  const { properties, items, anyOf, oneOf, allOf, dependencies } = schema;\n\n  for (const propName in schema) {\n    if (!schema.hasOwnProperty(propName)) {\n      continue;\n    }\n\n    if (propName.startsWith('ui:')) {\n      uiSchema[propName] = schema[propName];\n      delete schema[propName];\n    }\n  }\n\n  if (isObject(properties)) {\n    for (const propName in properties) {\n      if (!properties.hasOwnProperty(propName)) {\n        continue;\n      }\n\n      const schemaNode = properties[propName];\n      if (!isObject(schemaNode)) {\n        continue;\n      }\n      const innerUiSchema = {};\n      uiSchema[propName] = innerUiSchema;\n      extractUiSchema(schemaNode, innerUiSchema);\n    }\n  }\n\n  if (isObject(items)) {\n    const innerUiSchema = {};\n    uiSchema.items = innerUiSchema;\n    extractUiSchema(items, innerUiSchema);\n  }\n\n  if (Array.isArray(anyOf)) {\n    for (const schemaNode of anyOf) {\n      if (!isObject(schemaNode)) {\n        continue;\n      }\n      extractUiSchema(schemaNode, uiSchema);\n    }\n  }\n\n  if (Array.isArray(oneOf)) {\n    for (const schemaNode of oneOf) {\n      if (!isObject(schemaNode)) {\n        continue;\n      }\n      extractUiSchema(schemaNode, uiSchema);\n    }\n  }\n\n  if (Array.isArray(allOf)) {\n    for (const schemaNode of allOf) {\n      if (!isObject(schemaNode)) {\n        continue;\n      }\n      extractUiSchema(schemaNode, uiSchema);\n    }\n  }\n\n  if (isObject(dependencies)) {\n    for (const depName of Object.keys(dependencies)) {\n      const schemaNode = dependencies[depName];\n      if (!isObject(schemaNode)) {\n        continue;\n      }\n      extractUiSchema(schemaNode, uiSchema);\n    }\n  }\n}\n\n/**\n * @alpha\n * Takes a step from a Backstage Template Manifest and converts it to a JSON Schema and UI Schema for rjsf\n */\nexport const extractSchemaFromStep = (\n  inputStep: JsonObject,\n): { uiSchema: UiSchema; schema: JsonObject } => {\n  const uiSchema: UiSchema = {};\n  const returnSchema: JsonObject = JSON.parse(JSON.stringify(inputStep));\n  extractUiSchema(returnSchema, uiSchema);\n  return { uiSchema, schema: returnSchema };\n};\n\n/**\n * @alpha\n * Creates a field validation object for use in react jsonschema form\n */\nexport const createFieldValidation = (): FieldValidation => {\n  const fieldValidation: FieldValidation = {\n    __errors: [] as string[],\n    addError: (message: string) => {\n      fieldValidation.__errors?.push(message);\n    },\n  };\n\n  return fieldValidation;\n};\n"],"names":[],"mappings":"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"}